<div class="products-container">
	<!-- Header -->
	<div class="products-header">
		<h2 class="products-title">Product Modules</h2>
		<div class="products-actions">
			<button class="action-btn search-btn" [class.active]="showSearchPanel" (click)="toggleSearchPanel()" title="Advanced Search">
				<svg width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
					<circle cx="11" cy="11" r="8"></circle>
					<path d="m21 21-4.35-4.35"></path>
				</svg>
			</button>
			<button class="action-btn refresh-btn" (click)="refreshModules()" [disabled]="isLoading" title="Refresh">
				<svg width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24" [class.spinning]="isLoading">
					<path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"></path>
					<path d="M21 3v5h-5"></path>
					<path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"></path>
					<path d="M3 21v-5h5"></path>
				</svg>
			</button>
			<button class="btn btn-primary" (click)="addModule()">
				<svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
					<path d="M12 5v14M5 12h14"></path>
				</svg>
				<span>Add Module</span>
			</button>
		</div>
	</div>

	<!-- Search Panel -->
	<div class="search-panel" *ngIf="showSearchPanel">
		<div class="search-panel-header">
			<h3>Advanced Search</h3>
			<button class="close-btn" (click)="toggleSearchPanel()" aria-label="Close search panel">
				<svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
					<path d="M18 6 6 18"></path>
					<path d="m6 6 12 12"></path>
				</svg>
			</button>
		</div>
		<div class="search-panel-content">
			<div class="search-filters">
				<div class="filter-item">
					<label>Search by Name/Version/Release/Vision:</label>
					<input type="text" class="form-control" [(ngModel)]="searchTerm" (input)="onSearchChange()" placeholder="Enter search term..." />
				</div>
				<div class="filter-item">
					<label>Status:</label>
					<select class="form-control" [(ngModel)]="statusFilter" (change)="applyFilters()">
						<option value="">All Statuses</option>
						<option value="ACTIVE">Active</option>
						<option value="INACTIVE">Inactive</option>
						<option value="DEVELOPMENT">Development</option>
						<option value="MAINTENANCE">Maintenance</option>
					</select>
				</div>
				<div class="filter-item">
					<label>Product:</label>
					<select class="form-control" [(ngModel)]="productFilter" (change)="applyFilters()">
						<option value="">All Products</option>
						<option *ngFor="let p of products" [value]="p.id">{{ p.name }}</option>
					</select>
				</div>
			</div>
			<div class="search-actions">
				<button class="btn btn-secondary" (click)="clearFilters()">Clear All</button>
				<button class="btn btn-primary" (click)="applyFilters()">Apply Filters</button>
			</div>
		</div>
	</div>

	<!-- Content -->
	<div class="content-area">
		<div *ngIf="isLoading && isInitialLoad" class="loading-container">
			<div class="loading-spinner"></div>
			<div class="loading-text">Loading modules...</div>
		</div>

		<div *ngIf="error" class="error-container">
			<div class="error-icon">⚠️</div>
			<h3>Error</h3>
			<p>{{ error }}</p>
			<button class="btn btn-primary" (click)="refreshModules()">Try Again</button>
		</div>

		<ng-container *ngIf="!isLoading && !error">
			<div class="table-container">
				<table class="data-table">
					<thead>
						<tr>
							<th>Module</th>
							<th>Product</th>
							<th>Status</th>
							<th>Release</th>
							<th>Version</th>
							<th>Created</th>
							<th class="actions-cell">Actions</th>
						</tr>
					</thead>
					<tbody>
						<tr *ngFor="let m of paginatedModules; trackBy: trackByModuleId">
							<td class="product-name-cell">
								<div class="product-info">
									<div class="name">{{ m.name }}</div>
									<div class="vision" *ngIf="m.vision">{{ m.vision }}</div>
								</div>
							</td>
							<td class="owner-cell">{{ getProductName(m.productId) }}</td>
							<td class="status-cell">
								<span class="status-badge {{ getStatusBadgeClass(m.status) }}">{{ m.status }}</span>
							</td>
							<td class="release-cell">{{ m.currentRelease || '—' }}</td>
							<td class="version-cell">{{ m.version || '—' }}</td>
							<td class="created-cell">{{ formatDate(m.createdAt) }}</td>
							<td>
								<div class="actions-group">
									<button class="action-btn btn-outline edit-btn" (click)="editModule(m)" title="Edit">
										<svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
											<path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25z"></path>
										</svg>
									</button>
									<button class="action-btn btn-outline delete-btn" (click)="deleteModule(m)" title="Delete">
										<svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
											<path d="M3 6h18"></path>
											<path d="M8 6V4h8v2"></path>
											<path d="M6 6l1 14h10l1-14"></path>
										</svg>
									</button>
								</div>
							</td>
						</tr>

						<tr *ngIf="paginatedModules.length === 0">
							<td colspan="7" class="empty-cell">
								<div class="empty-state">
									<svg width="48" height="48" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24">
										<path stroke-linecap="round" stroke-linejoin="round" d="M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5m-6 6v2.625a3.375 3.375 0 003.375 3.375h1.5m-6-6H4.875m10.5-6H19.5m-4.125 0V4.875m0 6.75V19.5" />
									</svg>
									<h3>No modules found</h3>
									<p>Create the first module for a product.</p>
									<button class="btn btn-primary" (click)="addModule()">
										<svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
											<path d="M12 5v14M5 12h14"></path>
										</svg>
										<span>New Module</span>
									</button>
								</div>
							</td>
						</tr>
					</tbody>
				</table>

				<div *ngIf="isLoading && !isInitialLoad" class="mini-loading">
					<div class="mini-spinner"></div>
					<span>Refreshing...</span>
				</div>
			</div>

			<!-- Pagination -->
			<div class="pagination-container" *ngIf="!isLoading && filteredModules && filteredModules.length > 0">
				<div class="pagination-info">
					Showing {{ getStartIndex() }} to {{ getEndIndex() }} of {{ totalModules }} modules
				</div>
				<div class="pagination-controls">
					<button 
						class="pagination-btn" 
						(click)="goToPage(currentPage - 1)" 
						[disabled]="currentPage === 1 || isLoading"
						title="Previous Page">
						<svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
							<polyline points="15,18 9,12 15,6"/>
						</svg>
					</button>
					
					<div class="page-numbers">
						<button 
							*ngFor="let page of getVisiblePages()" 
							class="page-btn" 
							[class.active]="page === currentPage"
							(click)="goToPage(page)"
							[disabled]="isLoading">
							{{ page }}
						</button>
					</div>
					
					<button 
						class="pagination-btn" 
						(click)="goToPage(currentPage + 1)" 
						[disabled]="currentPage === totalPages || isLoading"
						title="Next Page">
						<svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
							<polyline points="9,18 15,12 9,6"/>
						</svg>
					</button>
				</div>
				<div class="page-size-selector">
					<label>Show:</label>
					<select class="form-control" [(ngModel)]="pageSize" (change)="onPageSizeChange()">
						<option value="10">10</option>
						<option value="25">25</option>
						<option value="50">50</option>
						<option value="100">100</option>
					</select>
					<span>per page</span>
				</div>
			</div>
		</ng-container>
	</div>

	<!-- Create/Edit Modal -->
	<div class="modal-overlay" *ngIf="isModalOpen">
		<div class="modal-container" role="dialog" aria-modal="true">
			<div class="modal-header">
				<h3>{{ isEditMode ? 'Edit Module' : 'Add New Module' }}</h3>
				<button class="modal-close-btn" (click)="closeModal()" aria-label="Close">
					<svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
						<path d="M18 6 6 18"></path>
						<path d="m6 6 12 12"></path>
					</svg>
				</button>
			</div>
			<div class="modal-content">
				<form [formGroup]="moduleForm" class="product-form" (ngSubmit)="saveModule()">
					<div class="form-grid">
						<div class="form-group">
							<label>Module Name *</label>
							<input type="text" class="form-input" placeholder="Enter module name" formControlName="name" />
						</div>
						<div class="form-group">
							<label>Product *</label>
							<select class="form-select" formControlName="productId">
								<option value="" disabled>Select product</option>
								<option *ngFor="let p of products" [value]="p.id">{{ p.name }}</option>
							</select>
						</div>
						<div class="form-group">
							<label>Status</label>
							<select class="form-select" formControlName="status">
								<option value="ACTIVE">Active</option>
								<option value="INACTIVE">Inactive</option>
								<option value="DEVELOPMENT">Development</option>
								<option value="MAINTENANCE">Maintenance</option>
							</select>
						</div>
						<div class="form-group">
							<label>Current Release</label>
							<input type="text" class="form-input" placeholder="Enter current release" formControlName="currentRelease" />
						</div>
						<div class="form-group">
							<label>Version</label>
							<input type="text" class="form-input" placeholder="Enter version" formControlName="version" />
						</div>
						<div class="form-group form-group-full">
							<label>Vision</label>
							<textarea class="form-textarea" placeholder="Describe the module vision" formControlName="vision"></textarea>
						</div>
					</div>
				</form>
			</div>
			<div class="modal-footer">
				<button class="btn btn-secondary" type="button" (click)="closeModal()">Cancel</button>
				<button class="btn btn-primary" type="button" (click)="saveModule()" [disabled]="moduleForm.invalid">
					{{ isEditMode ? 'Save Changes' : 'Create Module' }}
				</button>
			</div>
		</div>
	</div>

	<!-- Delete Modal -->
	<div class="modal-overlay" *ngIf="isDeleteModalOpen">
		<div class="modal-container modal-small" role="dialog" aria-modal="true">
			<div class="modal-header">
				<h3>Delete Module</h3>
				<button class="modal-close-btn" (click)="closeDeleteModal()" aria-label="Close">
					<svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
						<path d="M18 6 6 18"></path>
						<path d="m6 6 12 12"></path>
					</svg>
				</button>
			</div>
			<div class="modal-content">
				<div class="delete-confirmation">
					<div class="delete-icon">🗑️</div>
					<p>Are you sure you want to delete <strong>{{ selectedModule?.name }}</strong>?</p>
					<div class="warning-text">This action cannot be undone.</div>
				</div>
			</div>
			<div class="modal-footer">
				<button class="btn btn-secondary" type="button" (click)="closeDeleteModal()">Cancel</button>
				<button class="btn btn-danger" type="button" (click)="confirmDelete()">Delete</button>
			</div>
		</div>
	</div>
</div>

