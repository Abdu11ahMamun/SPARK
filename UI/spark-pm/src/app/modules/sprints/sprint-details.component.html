<div class="sprint-details-container">
  <!-- Header with Sprint Information -->
  <div class="sprint-header">
    <div class="header-navigation">
      <button class="btn btn-secondary" (click)="back()">
        <svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
          <path d="M19 12H5M12 19l-7-7 7-7"/>
        </svg>
        Back to Sprints
      </button>
    </div>
    
    <div class="sprint-info-card" *ngIf="sprint">
      <div class="sprint-title">
        <h1>{{ sprint.sprintName }}</h1>
        <span class="sprint-status" [class]="'status-' + sprint.status">
          {{ sprint.status === 1 ? 'Active' : sprint.status === 2 ? 'Completed' : 'Planning' }}
        </span>
      </div>
      
      <div class="sprint-meta">
        <div class="meta-item">
          <div class="meta-label">Duration</div>
          <div class="meta-value">{{ sprint.fromDate | date:'MMM d' }} - {{ sprint.toDate | date:'MMM d, y' }}</div>
        </div>
        <div class="meta-item">
          <div class="meta-label">Sprint Points</div>
          <div class="meta-value">{{ sprint.sprintPoint }}</div>
        </div>
        <div class="meta-item">
          <div class="meta-label">Holidays</div>
          <div class="meta-value">{{ sprint.noOfHolidays }} days</div>
        </div>
        <div class="meta-item">
          <div class="meta-label">Progress</div>
          <div class="meta-value">{{ getSprintProgress() }}%</div>
        </div>
      </div>
      
      <div class="sprint-description" *ngIf="sprint.detailsRemark">
        {{ sprint.detailsRemark }}
      </div>
    </div>
  </div>

  <!-- Loading State -->
  <div class="loading-state" *ngIf="isLoading">
    <div class="loading-spinner">
      <div class="spinner"></div>
      <p>Loading sprint details...</p>
    </div>
  </div>

  <!-- Error State -->
  <div class="error-state" *ngIf="isError && !isLoading">
    <div class="error-content">
      <svg width="48" height="48" fill="none" stroke="currentColor" stroke-width="1" viewBox="0 0 24 24">
        <path d="M12 9v2m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
      </svg>
      <h3>Failed to load sprint details</h3>
      <p>There was an error loading the sprint information.</p>
      <button class="btn btn-primary" (click)="fetchAll()">
        <svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
          <path d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
        </svg>
        Retry
      </button>
    </div>
  </div>

  <!-- Main Content with Tabs -->
  <div class="sprint-content" *ngIf="!isLoading && !isError">
    <!-- Tab Navigation -->
    <div class="tab-navigation">
      <button 
        class="tab-button" 
        [class.active]="activeTab === 'overview'"
        (click)="setActiveTab('overview')"
      >
        <svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
          <path d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/>
        </svg>
        Overview
      </button>
      
      <button 
        class="tab-button" 
        [class.active]="activeTab === 'tasks'"
        (click)="setActiveTab('tasks')"
      >
        <svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
          <path d="M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"/>
        </svg>
        Tasks
      </button>
      
      <button 
        class="tab-button" 
        [class.active]="activeTab === 'kanban'"
        (click)="setActiveTab('kanban')"
      >
        <svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
          <path d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"/>
        </svg>
        Kanban Board
      </button>
      
      <button 
        class="tab-button" 
        [class.active]="activeTab === 'burndown'"
        (click)="setActiveTab('burndown')"
      >
        <svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
          <path d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/>
        </svg>
        Burndown Chart
      </button>
    </div>

    <!-- Tab Content -->
    <div class="tab-content">
      <!-- No Data Available State -->
      <div class="no-data-state" *ngIf="hasNoData && !isLoading && !isError">
        <div class="no-data-content">
          <svg width="96" height="96" fill="none" stroke="currentColor" stroke-width="1" viewBox="0 0 24 24">
            <path d="M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"/>
          </svg>
          <h3>No Tasks Available</h3>
          <p>This sprint doesn't have any tasks assigned yet. Tasks will appear here once they are created and assigned to this sprint.</p>
          <button class="btn btn-primary" disabled>
            <svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
              <path d="M12 5v14m7-7H5"/>
            </svg>
            Add Task (Coming Soon)
          </button>
        </div>
      </div>

      <!-- Tab 1: Overview -->
      <div class="tab-pane" [class.active]="activeTab === 'overview'" *ngIf="!hasNoData">
        <div class="overview-grid">
          <!-- KPI Infograph Panel -->
          <div class="kpi-section panel">
            <h3>KPI Infograph</h3>
            <div class="kpi-grid">
              <div class="kpi-card">
                <div class="kpi-icon todo">
                  <svg width="24" height="24" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                    <path d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
                  </svg>
                </div>
                <div class="kpi-content">
                  <div class="kpi-value">{{ getTaskCountByStatus('TODO') }}</div>
                  <div class="kpi-label">To-Do</div>
                </div>
              </div>
              
              <div class="kpi-card">
                <div class="kpi-icon progress">
                  <svg width="24" height="24" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                    <path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"/>
                  </svg>
                </div>
                <div class="kpi-content">
                  <div class="kpi-value">{{ getTaskCountByStatus('IN_PROGRESS') }}</div>
                  <div class="kpi-label">In Progress</div>
                </div>
              </div>
              
              <div class="kpi-card">
                <div class="kpi-icon review">
                  <svg width="24" height="24" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                    <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                  </svg>
                </div>
                <div class="kpi-content">
                  <div class="kpi-value">{{ getTaskCountByStatus('REVIEW') }}</div>
                  <div class="kpi-label">Review</div>
                </div>
              </div>
              
              <div class="kpi-card">
                <div class="kpi-icon done">
                  <svg width="24" height="24" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                    <path d="M5 13l4 4L19 7"/>
                  </svg>
                </div>
                <div class="kpi-content">
                  <div class="kpi-value">{{ getTaskCountByStatus('DONE') }}</div>
                  <div class="kpi-label">Done</div>
                </div>
              </div>
            </div>
          </div>

          <!-- User Progress Bars Panel -->
          <div class="progress-section panel">
            <h3>User Progress Bars</h3>
            <div class="user-progress-list">
              <div class="user-progress-item" *ngFor="let user of getUserProgressData()">
                <div class="user-info">
                  <div class="user-avatar">{{ user.name.charAt(0).toUpperCase() }}</div>
                  <div class="user-details">
                    <div class="user-name">{{ user.name }}</div>
                    <div class="user-stats">{{ user.completedTasks }}/{{ user.totalTasks }} tasks</div>
                  </div>
                </div>
                <div class="progress-bar">
                  <div class="progress-fill" [style.width.%]="user.progress"></div>
                  <span class="progress-text">{{ user.progress }}%</span>
                </div>
              </div>
              <div class="no-users" *ngIf="getUserProgressData().length === 0">
                No assigned users yet
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Tab 2: Tasks Table -->
      <div class="tab-pane" [class.active]="activeTab === 'tasks'" *ngIf="!hasNoData">
        <div class="tasks-section">
          <div class="tasks-header">
            <h3>Tasks Table</h3>
            <button class="btn btn-primary" disabled>
              <svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                <path d="M12 5v14m7-7H5"/>
              </svg>
              Add Task
            </button>
          </div>
          
          <div class="tasks-filters">
            <div class="filter-group">
              <label>Filter by title:</label>
              <input 
                type="text" 
                class="form-control"
                [(ngModel)]="taskFilter.title"
                placeholder="Search tasks..."
              />
            </div>
            <div class="filter-group">
              <label>Status:</label>
              <select class="form-control" [(ngModel)]="taskFilter.status">
                <option value="">All Status</option>
                <option value="TODO">To-Do</option>
                <option value="IN_PROGRESS">In Progress</option>
                <option value="REVIEW">Review</option>
                <option value="DONE">Done</option>
              </select>
            </div>
            <div class="filter-group">
              <label>Assignee:</label>
              <input 
                type="text" 
                class="form-control"
                [(ngModel)]="taskFilter.assignee"
                placeholder="Filter by assignee..."
              />
            </div>
            <button class="btn btn-secondary" (click)="clearFilters()">Clear Filters</button>
          </div>

          <div class="tasks-table-container">
            <table class="tasks-table">
              <thead>
                <tr>
                  <th>Key</th>
                  <th>Title</th>
                  <th>Assignee</th>
                  <th>Status</th>
                  <th>Estimate</th>
                  <th>Priority</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let task of filteredTasks; trackBy: trackByTaskId">
                  <td>
                    <span class="task-key">{{ task.key || 'T-' + task.id }}</span>
                  </td>
                  <td>
                    <div class="task-title">{{ task.title }}</div>
                  </td>
                  <td>
                    <div class="task-assignee" *ngIf="task.assignee">
                      <div class="assignee-avatar">{{ task.assignee.charAt(0).toUpperCase() }}</div>
                      <span>{{ task.assignee }}</span>
                    </div>
                    <span class="unassigned" *ngIf="!task.assignee">Unassigned</span>
                  </td>
                  <td>
                    <span class="status-badge" [class]="'status-' + task.status?.toLowerCase()">
                      {{ task.status }}
                    </span>
                  </td>
                  <td>
                    <span class="estimate">{{ task.estimate || '—' }}</span>
                  </td>
                  <td>
                    <span class="priority" [class]="'priority-' + (task.priority || 'medium')?.toLowerCase()">
                      {{ task.priority || 'Medium' }}
                    </span>
                  </td>
                  <td>
                    <div class="task-actions">
                      <button class="action-btn edit" title="Edit Task" disabled>
                        <svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                          <path d="M11 4H4a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2v-7"/>
                          <path d="m18.5 2.5 3 3L12 15l-4 1 1-4 9.5-9.5z"/>
                        </svg>
                      </button>
                      <button class="action-btn delete" title="Delete Task" disabled>
                        <svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                          <path d="M3 6h18"/>
                          <path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/>
                        </svg>
                      </button>
                    </div>
                  </td>
                </tr>
                <tr *ngIf="filteredTasks.length === 0">
                  <td colspan="7" class="empty-state">
                    <div class="empty-content">
                      <svg width="48" height="48" fill="none" stroke="currentColor" stroke-width="1" viewBox="0 0 24 24">
                        <path d="M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"/>
                      </svg>
                      <p>No tasks found</p>
                    </div>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- Tab 3: Kanban Board -->
      <div class="tab-pane" [class.active]="activeTab === 'kanban'" *ngIf="!hasNoData">
        <div class="kanban-section">
          <h3>Kanban Board</h3>
          <div class="kanban-board">
            <div 
              class="kanban-column" 
              *ngFor="let column of kanbanColumns"
              (dragover)="onDragOver($event)"
              (drop)="onDrop($event, column.key)"
            >
              <div class="column-header">
                <h4>{{ column.title }}</h4>
                <span class="task-count">{{ column.tasks.length }}</span>
              </div>
              <div class="column-body">
                <div 
                  class="kanban-card"
                  *ngFor="let task of column.tasks"
                  draggable="true"
                  (dragstart)="onDragStart($event, task)"
                >
                  <div class="card-header">
                    <span class="card-key">{{ task.key || 'T-' + task.id }}</span>
                    <span class="card-priority" [class]="'priority-' + (task.priority || 'medium')?.toLowerCase()">
                      {{ task.priority || 'Med' }}
                    </span>
                  </div>
                  <div class="card-title">{{ task.title }}</div>
                  <div class="card-meta">
                    <div class="card-assignee" *ngIf="task.assignee">
                      <div class="assignee-avatar">{{ task.assignee.charAt(0).toUpperCase() }}</div>
                      <span>{{ task.assignee }}</span>
                    </div>
                    <div class="card-estimate" *ngIf="task.estimate">
                      <svg width="14" height="14" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                        <path d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
                      </svg>
                      {{ task.estimate }}
                    </div>
                  </div>
                </div>
                <div class="column-empty" *ngIf="column.tasks.length === 0">
                  Drop tasks here
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Tab 4: Burndown Chart -->
      <div class="tab-pane" [class.active]="activeTab === 'burndown'" *ngIf="!hasNoData">
        <div class="burndown-section">
          <h3>Burndown Chart</h3>
          <div class="chart-container">
            <canvas #burndownCanvas></canvas>
          </div>
          <div class="chart-legend">
            <div class="legend-item">
              <div class="legend-color ideal"></div>
              <span>Ideal Progress</span>
            </div>
            <div class="legend-item">
              <div class="legend-color actual"></div>
              <span>Actual Progress</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
