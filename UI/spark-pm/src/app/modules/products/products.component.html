<div class="products-container">
	<!-- Products Header -->
	<div class="products-header">
		<h1 class="products-title">Product Management</h1>
		<div class="products-actions">
			<button class="action-btn search-btn" (click)="toggleSearchPanel()" title="Advanced Search" [class.active]="showSearchPanel">
				<svg width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
					<circle cx="11" cy="11" r="8"/>
					<path d="m21 21-4.35-4.35"/>
				</svg>
			</button>
			<button class="action-btn refresh-btn" (click)="refreshProducts()" title="Refresh Products" [disabled]="isLoading">
				<svg width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24" [class.spinning]="isLoading">
					<path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"/>
					<path d="M21 3v5h-5"/>
					<path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"/>
					<path d="M3 21v-5h5"/>
				</svg>
			</button>
			<button class="btn btn-primary" (click)="addProduct()" [disabled]="isLoading">
				<svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
					<path d="M12 5v14M5 12h14"/>
				</svg>
				Add Product
			</button>
		</div>
	</div>

	<!-- Advanced Search Panel -->
	<div *ngIf="showSearchPanel" class="search-panel">
		<div class="search-panel-header">
			<h3>Advanced Search</h3>
			<button class="close-btn" (click)="toggleSearchPanel()">
				<svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
					<path d="M18 6 6 18"/>
					<path d="m6 6 12 12"/>
				</svg>
			</button>
		</div>
		<div class="search-panel-content">
			<div class="search-filters">
				<div class="filter-item">
					<label>Search by Name/Version/Release:</label>
					<input
						type="text"
						class="form-control"
						placeholder="Enter search term..."
						[(ngModel)]="searchTerm"
						(input)="onSearchChange()"
					/>
				</div>
				<div class="filter-item">
					<label>Status:</label>
					<select class="form-control" [(ngModel)]="statusFilter" (change)="applyFilters()">
						<option value="">All Statuses</option>
						<option value="ACTIVE">Active</option>
						<option value="INACTIVE">Inactive</option>
						<option value="DEVELOPMENT">Development</option>
						<option value="MAINTENANCE">Maintenance</option>
					</select>
				</div>
				<div class="filter-item">
					<label>Product Owner:</label>
					<select class="form-control" [(ngModel)]="userFilter" (change)="applyFilters()">
						<option value="">All Owners</option>
						<option *ngFor="let user of users" [value]="user.id">
							{{user.firstName}} {{user.lastName}}
						</option>
					</select>
				</div>
				<div class="filter-actions">
					<button class="btn btn-secondary" (click)="clearFilters()">Clear Filters</button>
				</div>
			</div>
		</div>
	</div>

	<!-- Content Area -->
	<div class="content-area">
		<!-- Loading State -->
		<div *ngIf="isLoading && isInitialLoad" class="loading-container">
			<div class="loading-spinner"></div>
			<div class="loading-text">Loading products...</div>
		</div>

		<!-- Error State -->
		<div *ngIf="error && !isLoading" class="error-container">
			<div class="error-icon">⚠️</div>
			<h3>Failed to load products</h3>
			<p>{{ error }}</p>
			<button class="btn btn-primary" (click)="refreshProducts()">
				<svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
					<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
				</svg>
				Try Again
			</button>
		</div>

		<!-- Products Table -->
		<div *ngIf="!isLoading || !isInitialLoad" class="table-container">
			<!-- Mini loading for subsequent loads -->
			<div *ngIf="isLoading && !isInitialLoad" class="mini-loading">
				<div class="mini-spinner"></div>
				Updating...
			</div>

			<table class="data-table">
				<thead>
					<tr>
						<th>PRODUCT NAME</th>
						<th>PRODUCT OWNER</th>
						<th>STATUS</th>
						<th>CURRENT RELEASE</th>
						<th>VERSION</th>
						<th>CREATED</th>
						<th>ACTIONS</th>
					</tr>
				</thead>
				<tbody>
					<!-- Empty State -->
					<tr *ngIf="paginatedProducts.length === 0 && !isLoading" class="empty-row">
						<td colspan="7" class="empty-cell">
							<div class="empty-state">
								<svg width="64" height="64" fill="none" stroke="currentColor" viewBox="0 0 24 24">
									<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4"></path>
								</svg>
								<h3>No products found</h3>
								<p *ngIf="searchTerm || statusFilter || userFilter">
									Try adjusting your search criteria or filters.
								</p>
								<p *ngIf="!searchTerm && !statusFilter && !userFilter">
									Get started by creating your first product.
								</p>
								<button *ngIf="searchTerm || statusFilter || userFilter" 
												class="btn btn-secondary" 
												(click)="clearFilters()">
									Clear Filters
								</button>
							</div>
						</td>
					</tr>

					<!-- Product Rows -->
					<tr *ngFor="let product of paginatedProducts; trackBy: trackByProductId" class="table-row">
						<td class="product-name-cell">
							<div class="product-info">
								<div class="name">{{ product.name }}</div>
								<div class="vision" *ngIf="product.vision">{{ product.vision }}</div>
							</div>
						</td>
						<td class="owner-cell">
							{{ getProductOwnerName(product.productOwnerId) }}
						</td>
						<td class="status-cell">
							<span class="status-badge" [ngClass]="getStatusBadgeClass(product.status)">
								{{ product.status }}
							</span>
						</td>
						<td class="release-cell">
							{{ product.currentRelease || '—' }}
						</td>
						<td class="version-cell">
							{{ product.version || '—' }}
						</td>
						<td class="created-cell">
							{{ formatDate(product.createdAt) }}
						</td>
						<td class="actions-cell">
							<div class="actions-group">
								<button 
									class="action-btn edit-btn" 
									(click)="editProduct(product)"
									title="Edit Product">
									<svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
										<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
									</svg>
								</button>
								<button 
									class="action-btn delete-btn" 
									(click)="deleteProduct(product)"
									title="Delete Product">
									<svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
										<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
									</svg>
								</button>
							</div>
						</td>
					</tr>
				</tbody>
			</table>

			<!-- Pagination -->
			<div *ngIf="totalPages > 1" class="pagination-container">
				<div class="pagination-info">
					Showing {{ ((currentPage - 1) * itemsPerPage) + 1 }} to {{ Math.min(currentPage * itemsPerPage, totalItems) }} of {{ totalItems }} products
				</div>
				<div class="pagination-controls">
					<button class="btn btn-outline" 
									[disabled]="currentPage <= 1" 
									(click)="goToFirstPage()">
						First
					</button>
					<button class="btn btn-outline" 
									[disabled]="currentPage <= 1" 
									(click)="goToPreviousPage()">
						Previous
					</button>
					<button *ngFor="let page of getPageNumbers()" 
									class="btn btn-outline"
									[class.active]="page === currentPage"
									(click)="goToPage(page)">
						{{ page }}
					</button>
					<button class="btn btn-outline" 
									[disabled]="currentPage >= totalPages" 
									(click)="goToNextPage()">
						Next
					</button>
					<button class="btn btn-outline" 
									[disabled]="currentPage >= totalPages" 
									(click)="goToLastPage()">
						Last
					</button>
				</div>
			</div>
		</div>
	</div>
</div>

<!-- Add/Edit Product Modal -->
<div *ngIf="isModalOpen" class="modal-overlay" (click)="closeModal()">
	<div class="modal-container" (click)="$event.stopPropagation()">
		<div class="modal-header">
			<h3>{{ isEditMode ? 'Edit Product' : 'Add New Product' }}</h3>
			<button class="modal-close-btn" (click)="closeModal()">
				<svg width="24" height="24" fill="none" stroke="currentColor" viewBox="0 0 24 24">
					<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
				</svg>
			</button>
		</div>
    
		<div class="modal-content">
			<form [formGroup]="productForm" class="product-form">
				<div class="form-grid">
					<!-- Product Name -->
					<div class="form-group">
						<label for="name">Product Name *</label>
						<input 
							type="text" 
							id="name"
							formControlName="name"
							placeholder="Enter product name"
							class="form-input">
					</div>

					<!-- Product Owner -->
					<div class="form-group">
						<label for="productOwnerId">Product Owner *</label>
						<select 
							id="productOwnerId"
							formControlName="productOwnerId"
							class="form-select">
							<option value="">Select a user</option>
							<option *ngFor="let user of users" [value]="user.id">
								{{ user.firstName }} {{ user.lastName }}
							</option>
						</select>
					</div>

					<!-- Status -->
					<div class="form-group">
						<label for="status">Status</label>
						<select 
							id="status"
							formControlName="status"
							class="form-select">
							<option value="ACTIVE">Active</option>
							<option value="INACTIVE">Inactive</option>
							<option value="DEVELOPMENT">Development</option>
							<option value="MAINTENANCE">Maintenance</option>
						</select>
					</div>

					<!-- Current Release -->
					<div class="form-group">
						<label for="currentRelease">Current Release</label>
						<input 
							type="text" 
							id="currentRelease"
							formControlName="currentRelease"
							placeholder="Enter current release"
							class="form-input">
					</div>

					<!-- Version -->
					<div class="form-group">
						<label for="version">Version</label>
						<input 
							type="text" 
							id="version"
							formControlName="version"
							placeholder="Enter version"
							class="form-input">
					</div>

					<!-- Dependent Products -->
					<div class="form-group">
						<label for="dependentProducts">Dependent Products</label>
						<input 
							type="number" 
							id="dependentProducts"
							formControlName="dependentProducts"
							placeholder="Number of dependent products"
							min="0"
							class="form-input">
					</div>

					<!-- Vision -->
					<div class="form-group form-group-full">
						<label for="vision">Vision</label>
						<textarea 
							id="vision"
							formControlName="vision"
							placeholder="Describe the product vision"
							rows="3"
							class="form-textarea"></textarea>
					</div>
				</div>
			</form>
		</div>
    
		<div class="modal-footer">
			<button type="button" class="btn btn-secondary" (click)="closeModal()">
				Cancel
			</button>
			<button type="button" class="btn btn-primary" (click)="saveProduct()" [disabled]="productForm.invalid">
				{{ isEditMode ? 'Update Product' : 'Create Product' }}
			</button>
		</div>
	</div>
</div>

<!-- Delete Confirmation Modal -->
<div *ngIf="isDeleteModalOpen" class="modal-overlay" (click)="closeDeleteModal()">
	<div class="modal-container modal-small" (click)="$event.stopPropagation()">
		<div class="modal-header">
			<h3>Confirm Delete</h3>
			<button class="modal-close-btn" (click)="closeDeleteModal()">
				<svg width="24" height="24" fill="none" stroke="currentColor" viewBox="0 0 24 24">
					<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
				</svg>
			</button>
		</div>
    
		<div class="modal-content">
			<div class="delete-confirmation">
				<div class="delete-icon">🗑️</div>
				<p>Are you sure you want to delete <strong>{{ selectedProduct?.name }}</strong>?</p>
				<p class="warning-text">This action cannot be undone.</p>
			</div>
		</div>
    
		<div class="modal-footer">
			<button type="button" class="btn btn-secondary" (click)="closeDeleteModal()">
				Cancel
			</button>
			<button type="button" class="btn btn-danger" (click)="confirmDelete()">
				Delete
			</button>
		</div>
	</div>
</div>

